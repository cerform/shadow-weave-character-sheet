# üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
npm run test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∑–∞—â–∏—Ç—ã –æ—Ç React Error #185
npm run test -- src/stores/__tests__/unifiedBattleStoreExports.test.ts

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å coverage
npm run test -- --coverage

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ watch —Ä–µ–∂–∏–º–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
npm run test -- --watch
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
src/
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ       ‚îî‚îÄ‚îÄ unifiedBattleStoreExports.test.ts  ‚Üê –¢–µ—Å—Ç—ã —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ battle/
‚îÇ       ‚îî‚îÄ‚îÄ enhanced/
‚îÇ           ‚îî‚îÄ‚îÄ __tests__/
‚îÇ               ‚îú‚îÄ‚îÄ EnhancedBattleToken3D.test.tsx  ‚Üê –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
‚îÇ               ‚îî‚îÄ‚îÄ ModelLoader.test.tsx           ‚Üê –¢–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –º–æ–¥–µ–ª–µ–π
‚îî‚îÄ‚îÄ __tests__/
    ‚îî‚îÄ‚îÄ setup.ts  ‚Üê –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤
```

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è?

### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç React Error #185

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤**
   - –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤

2. **Rules of Hooks**
   - –•—É–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   - –ù–µ—Ç —É—Å–ª–æ–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Ö—É–∫–æ–≤
   - –ù–µ—Ç —Ö—É–∫–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–æ–≤

3. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è useGLTF**
   - –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –ø—É—Ç—å
   - –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–º–µ—Å—Ç–æ —É—Å–ª–æ–≤–Ω—ã—Ö —Ö—É–∫–æ–≤

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å event handlers**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ startTransition
   - –ë–∞—Ç—á–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π state

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

```
‚úì src/stores/__tests__/unifiedBattleStoreExports.test.ts (15)
‚úì src/components/battle/enhanced/__tests__/EnhancedBattleToken3D.test.tsx (12)
‚úì src/components/battle/enhanced/__tests__/ModelLoader.test.tsx (8)

Test Files  3 passed (3)
Tests  35 passed (35)
```

**–û–∑–Ω–∞—á–∞–µ—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç React Error #185 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! ‚úÖ

### ‚ùå –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

```
‚úó –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å —Ö—É–∫–∏ –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
  Error: Rendered fewer hooks than expected
```

**–û–∑–Ω–∞—á–∞–µ—Ç:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏—è Rules of Hooks!

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ö—É–∫–∏ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ useGLTF
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å HooksViolationDetector –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## Coverage Report

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `npm run test -- --coverage` –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ—Ç—á–µ—Ç:

```
File                                    | % Stmts | % Branch | % Funcs | % Lines
----------------------------------------|---------|----------|---------|--------
stores/unifiedBattleStoreExports.ts     | 100     | 100      | 100     | 100
components/.../EnhancedBattleToken3D    | 92.5    | 88.3     | 95.0    | 92.5
components/.../ModelLoader.tsx          | 100     | 100      | 100     | 100
```

## Pre-commit Hook (Husky) üê∫

–ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º:

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è Husky (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
npx husky init
chmod +x .husky/pre-commit

# Husky –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º git commit
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ ESLint –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –¢–µ—Å—Ç—ã —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ critical —Ñ–∞–π–ª–æ–≤

–°–º. `HUSKY_SETUP.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## CI/CD Integration

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏:
- **Pre-commit** - Husky hook –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º (–ª–æ–∫–∞–ª—å–Ω–æ) ‚ú®
- **Push** - –≤ –ª—é–±—É—é –≤–µ—Ç–∫—É (–≤ CI)
- **Pull Request** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot find module '@/...'"

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `vitest.config.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π alias:

```typescript
resolve: {
  alias: {
    '@': path.resolve(__dirname, './src'),
  },
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: "WebGL context error"

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `src/__tests__/setup.ts` —á–µ—Ä–µ–∑ mock WebGL context.

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ `Ctrl+C` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å —Ñ–ª–∞–≥–æ–º `--run`:

```bash
npm run test -- --run
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `*.test.ts` –∏–ª–∏ `*.test.tsx` —Ä—è–¥–æ–º —Å —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º –∫–æ–¥–æ–º
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã:

```typescript
import { describe, it, expect } from 'vitest';
import { renderHook, act } from '@testing-library/react';
```

3. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç:

```typescript
describe('MyFeature', () => {
  it('–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', () => {
    // Arrange
    const { result } = renderHook(() => useMyHook());
    
    // Act
    act(() => {
      // –î–µ–π—Å—Ç–≤–∏—è
    });
    
    // Assert
    expect(result.current).toBe(expected);
  });
});
```

## –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `TESTING.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
