# üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –æ—à–∏–±–æ–∫ React Hooks

## –ü—Ä–æ–±–ª–µ–º–∞
React Error #185 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ Rules of Hooks:
- –•—É–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ (–≤ if/try-catch)
- –•—É–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ü–∏–∫–ª–∞—Ö (map/forEach)
- –•—É–∫–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∞–º–∏

## –†–µ—à–µ–Ω–∏–µ: –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

### 1Ô∏è‚É£ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
**–§–∞–π–ª:** `src/components/battle/enhanced/ModelLoader.tsx`

- –ö–∞–∂–¥–∞—è 3D –º–æ–¥–µ–ª—å = –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ú –ø—É—Ç–µ–º
- `useGLTF("/models/fighter.glb")` - –ø—É—Ç—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—ã–π –†–ï–ù–î–ï–†–ò–ù–ì, –Ω–µ —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—ã–µ —Ö—É–∫–∏

```tsx
// ‚ùå –ü–õ–û–•–û - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å
const Model = ({ path }) => {
  const gltf = useGLTF(path); // path –º–µ–Ω—è–µ—Ç—Å—è!
}

// ‚úÖ –•–û–†–û–®–û - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
const FighterModel = () => {
  const gltf = useGLTF("/models/fighter.glb"); // –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞!
}
```

### 2Ô∏è‚É£ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (ESLint)
**–§–∞–π–ª:** `.eslintrc.json`

–ü—Ä–∞–≤–∏–ª–∞:
- `react-hooks/rules-of-hooks: error` - –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è
- `react-hooks/exhaustive-deps: warn` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
npm run lint
# –∏–ª–∏
npx eslint src/**/*.tsx
```

### 3Ô∏è‚É£ Runtime –≤–∞–ª–∏–¥–∞—Ü–∏—è
**–§–∞–π–ª:** `src/utils/hooksValidator.ts`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ç:
- ‚úÖ –•—É–∫–∏ –≤ —É—Å–ª–æ–≤–Ω—ã—Ö –±–ª–æ–∫–∞—Ö (if/ternary)
- ‚úÖ –•—É–∫–∏ –≤ —Ü–∏–∫–ª–∞—Ö (map/forEach/for)
- ‚úÖ –•—É–∫–∏ –≤ try-catch

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```typescript
import { hooksValidator } from '@/utils/hooksValidator';

// –í development –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è
hooksValidator.validateHookCall('useMyHook', 'MyComponent');

// –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç
window.__HOOKS_VALIDATOR__.printReport();
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HooksViolationDetector

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/components/debug/HooksViolationDetector.tsx`

–î–æ–±–∞–≤–ª–µ–Ω –Ω–∞ `BattleMapPage` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç React Error #185 –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏
- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –æ—Ç—á—ë—Ç–∞ –≤ `.txt` —Ñ–∞–π–ª
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –æ—à–∏–±–æ–∫

## –ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ –±—É–¥—É—â–µ–º

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**
```tsx
const ButtonRed = () => { const [x] = useState(0); ... }
const ButtonBlue = () => { const [x] = useState(0); ... }

<>
  {isRed && <ButtonRed />}
  {!isRed && <ButtonBlue />}
</>
```

2. **–•—É–∫–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ**
```tsx
function Component() {
  const data = useData(); // ‚úÖ –ø–µ—Ä–≤—ã–π
  const [state] = useState(0); // ‚úÖ –≤—Ç–æ—Ä–æ–π
  
  if (!data) return null; // ‚úÖ return –ü–û–°–õ–ï —Ö—É–∫–æ–≤
}
```

3. **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**
```tsx
const items = useMemo(() => [...], [deps]);
const Component = memo(() => { ... });
```

### ‚ùå –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

```tsx
// ‚ùå –•—É–∫ –≤ —É—Å–ª–æ–≤–∏–∏
if (condition) {
  const [x] = useState(0);
}

// ‚ùå –•—É–∫ –≤ —Ü–∏–∫–ª–µ  
items.map(item => {
  const data = useData(item.id);
  return <div>{data}</div>;
});

// ‚ùå –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å
const gltf = useGLTF(dynamicPath);

// ‚ùå –†–∞–Ω–Ω–∏–π return –ø–µ—Ä–µ–¥ —Ö—É–∫–æ–º
if (!data) return null;
const [x] = useState(0);
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å ESLint
npm run lint

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã
npm run typecheck

# 3. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–µ–∫—Ç–æ—Ä
# –û—Ç–∫—Ä–æ–π—Ç–µ /dm/battle-map/:sessionId
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –¥–µ—Ç–µ–∫—Ç–æ—Ä –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
```

## –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫

1. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
2. –ù–∞–π—Ç–∏ `__HOOKS_VALIDATOR__` –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. –í—ã–∑–≤–∞—Ç—å `__HOOKS_VALIDATOR__.printReport()`
4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –∏–∑ HooksViolationDetector

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [React Rules of Hooks](https://react.dev/reference/rules/rules-of-hooks)
- [ESLint Plugin React Hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks)
- [React Error Decoder #185](https://reactjs.org/docs/error-decoder.html?invariant=185)
