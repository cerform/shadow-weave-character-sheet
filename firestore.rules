
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–µ–±–µ
    match /users/{userId} {
      allow read, write: if request.auth != null
                      && request.auth.uid == userId;
    }

    // ‚öîÔ∏è –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
    match /characters/{characterId} {
      allow read:   if request.auth != null
                  && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null
                  && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
                          && resource.data.userId == request.auth.uid;
    }

    // üßô‚Äç‚ôÇÔ∏è DM's –¥–∞–Ω–Ω—ã–µ: —Ç–æ–ª—å–∫–æ DM –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
    match /DMs/{dmId} {
      allow read, write: if request.auth != null
                      && request.auth.uid == dmId;
    }

    // üìñ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è: –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å
    match /spells/{spellId} {
      allow read:  if true;
      allow write: if false;
    }

    // üéÆ –°–µ—Å—Å–∏–∏:
    // - —Å–æ–∑–¥–∞–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç
    // - —á—Ç–µ–Ω–∏–µ ‚Äî –ª—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∂—ë—Å—Ç–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∏–∂–µ)
    // - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ —Ö–æ—Å—Ç
    match /sessions/{sessionId} {
      allow create: if request.auth != null
                  && request.auth.uid == request.resource.data.hostId;

      allow read:   if request.auth != null;

      allow update: if request.auth != null
                  && request.auth.uid == resource.data.hostId;

      allow delete: if request.auth != null
                  && request.auth.uid == resource.data.hostId;
    }
  }
}
