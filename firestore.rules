
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–µ–±–µ
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ‚öîÔ∏è –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
    match /characters/{characterId} {
      // –†–∞–∑—Ä–µ—à–∞–µ–º —á—Ç–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –µ—Å–ª–∏ user.id —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å userId –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid);
      
      // –î–ª—è –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–π userId
      allow write: if request.auth != null && 
        (request.resource.data.userId == request.auth.uid || request.resource.data.userId == null);
    }

    // üßô‚Äç‚ôÇÔ∏è DM's –¥–∞–Ω–Ω—ã–µ (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è): —Ç–æ–ª—å–∫–æ DM –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø
    match /DMs/{dmId} {
      allow read, write: if request.auth != null && request.auth.uid == dmId;
    }

    // üìñ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è: –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è, –Ω–æ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å
    match /spells/{spellId} {
      allow read: if true;
      allow write: if false;
    }

    // üéÆ –°–µ—Å—Å–∏–∏: –¥–æ—Å—Ç—É–ø–Ω—ã –ª—é–±–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É
    match /sessions/{sessionId} {
      allow read, write: if request.auth != null;
    }
  }
}
