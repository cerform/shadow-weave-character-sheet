
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–µ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
    match /users/{userId} {
      allow read, write: if request.auth != null
                      && request.auth.uid == userId;
    }

    // ‚öîÔ∏è –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
    match /characters/{characterId} {
      // üì• –ß–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç (get): —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
      allow get: if request.auth != null
              && resource.data.userId == request.auth.uid;

      // üìã –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (list): —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ –∫–æ–¥–µ)
      allow list: if request.auth != null;

      // ‚úçÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏
      allow create: if request.auth != null
                  && request.auth.uid == request.resource.data.userId;

      // ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü
      allow update, delete: if request.auth != null
                          && resource.data.userId == request.auth.uid;
    }

    // üßô‚Äç‚ôÇÔ∏è DM-–ø—Ä–æ—Ñ–∏–ª–∏: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–µ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
    match /DMs/{dmId} {
      allow read, write: if request.auth != null
                      && request.auth.uid == dmId;
    }

    // üìñ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è: –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å
    match /spells/{spellId} {
      allow read:  if true;
      allow write: if false;
    }

    // üéÆ –°–µ—Å—Å–∏–∏: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ—Å—Ç–∞
    match /sessions/{sessionId} {
      allow create: if request.auth != null
                  && request.auth.uid == request.resource.data.hostId;

      allow read: if request.auth != null;

      allow update, delete: if request.auth != null
                          && resource.data.hostId == request.auth.uid;
    }
  }
}
