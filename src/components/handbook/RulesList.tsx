import React from 'react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { useTheme } from '@/hooks/use-theme';
import { themes } from '@/lib/themes';

interface RulesListProps {
  searchQuery: string;
  setSelectedRule: (rule: any) => void;
}

const rulesData = [
  {
    id: 'character-creation',
    title: 'Создание персонажа',
    category: 'Основные правила',
    description: 'Пошаговое руководство по созданию персонажа в D&D 5e',
    content: `
# Создание персонажа

## Шаг 1: Выберите расу
Раса персонажа определяет множество его характеристик: размер, скорость, языки, особые способности и бонусы к характеристикам.

## Шаг 2: Выберите класс
Класс определяет основные способности персонажа, его роль в группе и путь развития.

## Шаг 3: Определите значения характеристик
Шесть основных характеристик: Сила, Ловкость, Телосложение, Интеллект, Мудрость, Харизма.

## Шаг 4: Опишите персонажа
Выберите предысторию, определите мировоззрение, внешность и характер.

## Шаг 5: Выберите снаряжение
Определите начальное снаряжение и экипировку персонажа.
    `
  },
  {
    id: 'ability-scores',
    title: 'Характеристики',
    category: 'Основные правила',
    description: 'Описание шести основных характеристик и их применение',
    content: `
# Характеристики

## Сила (Strength)
- Определяет физическую мощь персонажа
- Влияет на урон в ближнем бою и способность переносить тяжести
- Проверки Силы: прыжки, плавание, взлом

## Ловкость (Dexterity)
- Определяет проворность и скорость реакции
- Влияет на Класс Доспеха и инициативу
- Проверки Ловкости: скрытность, ловкость рук, акробатика

## Телосложение (Constitution)
- Определяет выносливость и здоровье
- Влияет на хиты и устойчивость к болезням
- Проверки Телосложения: сопротивление усталости, яду

## Интеллект (Intelligence)
- Определяет способность к рассуждению и памяти
- Влияет на знания и расследования
- Проверки Интеллекта: история, магия, природа

## Мудрость (Wisdom)
- Определяет интуицию и восприятие
- Влияет на внимательность и понимание
- Проверки Мудрости: восприятие, выживание, медицина

## Харизма (Charisma)
- Определяет силу личности и лидерские качества
- Влияет на социальные взаимодействия
- Проверки Харизмы: убеждение, обман, запугивание
    `
  },
  {
    id: 'combat',
    title: 'Боевые правила',
    category: 'Боевая система',
    description: 'Правила ведения боя: инициатива, действия, атаки и защита',
    content: `
# Боевые правила

## Порядок боя
1. **Инициатива**: Все участники бросают d20 + модификатор Ловкости
2. **Ходы**: Участники действуют в порядке убывания инициативы
3. **Раунды**: Каждый раунд длится ~6 секунд игрового времени

## Действия в бою
### Основное действие (Action)
- Атака
- Сотворение заклинания
- Рывок (удвоение скорости)
- Уклонение (+2 к КД до следующего хода)
- Помощь союзнику
- Поиск
- Готовность

### Бонусное действие (Bonus Action)
- Некоторые заклинания и способности
- Бой двумя оружиями
- Классовые особенности

### Реакция (Reaction)
- Атака при возможности
- Некоторые заклинания
- Готовые действия

### Движение (Movement)
- Можно перемещаться до значения скорости
- Можно разделить движение до и после действий

## Атаки
1. Выберите цель в пределах досягаемости
2. Бросьте d20 + бонус атаки
3. Сравните с Классом Доспеха цели
4. При попадании бросьте урон

## Класс Доспеха (КД)
- Базовый КД = 10 + модификатор Ловкости
- Доспехи заменяют базовый КД
- Щиты добавляют +2 к КД
    `
  },
  {
    id: 'spellcasting',
    title: 'Магия и заклинания',
    category: 'Магическая система',
    description: 'Правила использования магии, ячейки заклинаний и сотворение',
    content: `
# Магия и заклинания

## Основы магии
Заклинания - это дискретные магические эффекты с определенными правилами и ограничениями.

## Ячейки заклинаний
- Магию питают ячейки заклинаний
- Ячейки имеют уровни от 1 до 9
- Заклинание тратит ячейку своего уровня или выше
- Ячейки восстанавливаются после длительного отдыха

## Характеристики заклинаний
### Время сотворения
- **Действие**: большинство заклинаний
- **Бонусное действие**: быстрые заклинания
- **Реакция**: мгновенный ответ
- **Минуты/часы**: ритуалы и продолжительные заклинания

### Дистанция
- **Касание**: нужно коснуться цели
- **Себя**: влияет только на заклинателя
- **Футы**: конкретное расстояние
- **Зрение**: пока видите цель

### Длительность
- **Мгновенная**: эффект происходит и заканчивается
- **Концентрация**: требует поддержания внимания
- **Время**: конкретный период действия

### Компоненты
- **Вербальные (V)**: произнесение слов силы
- **Соматические (S)**: жесты рукой
- **Материальные (M)**: физические компоненты

## Концентрация
- Одновременно можно поддерживать только одно заклинание
- При получении урона - спасбросок Телосложения (СЛ 10 или половина урона)
- Прерывается при потере сознания или смерти
    `
  },
  {
    id: 'skills',
    title: 'Навыки и проверки',
    category: 'Основные правила',
    description: 'Система навыков, проверки характеристик и спасительные броски',
    content: `
# Навыки и проверки

## Проверки характеристик
- Бросок d20 + модификатор характеристики
- Сложность определяется Классом Сложности (СЛ)
- СЛ 5 - очень легко, СЛ 30 - почти невозможно

## Навыки
Каждый навык связан с определенной характеристикой:

### Навыки Силы
- **Атлетика**: плавание, прыжки, лазание

### Навыки Ловкости
- **Акробатика**: равновесие, перекаты
- **Ловкость рук**: карманные кражи, фокусы
- **Скрытность**: незаметное передвижение

### Навыки Интеллекта
- **Магия**: знание заклинаний и магических эффектов
- **История**: знание исторических событий
- **Расследование**: поиск улик и выводы
- **Природа**: знание животных, растений, погоды
- **Религия**: знание божеств, ритуалов, священных символов

### Навыки Мудрости
- **Восприятие**: замечание деталей
- **Выживание**: следопытство, навигация
- **Медицина**: стабилизация умирающих
- **Проницательность**: понимание мотивов
- **Уход за животными**: обращение с животными

### Навыки Харизмы
- **Запугивание**: принуждение угрозами
- **Обман**: сокрытие правды
- **Представление**: развлечение публики
- **Убеждение**: честное влияние на других

## Владение навыками
- Добавляет бонус мастерства к проверкам
- Получается от расы, класса, предыстории

## Спасительные броски
- Защита от заклинаний и особых эффектов
- d20 + модификатор характеристики + (бонус мастерства при владении)
- Каждый класс владеет двумя спасбросками
    `
  },
  {
    id: 'conditions',
    title: 'Состояния',
    category: 'Основные правила',
    description: 'Различные состояния, влияющие на персонажей в игре',
    content: `
# Состояния

## Ослепление (Blinded)
- Автоматически проваливает проверки, требующие зрения
- Броски атаки с помехой
- Атаки по персонажу с преимуществом

## Очарование (Charmed)
- Не может атаковать очаровавшего
- Очаровавший имеет преимущество в социальных взаимодействиях

## Глухота (Deafened)
- Автоматически проваливает проверки, требующие слуха

## Испуг (Frightened)
- Помеха на проверки характеристик и броски атаки, пока источник страха виден
- Не может приближаться к источнику страха

## Захват (Grappled)
- Скорость становится 0
- Состояние заканчивается, если захватчик недееспособен

## Недееспособность (Incapacitated)
- Не может совершать действия или реакции

## Невидимость (Invisible)
- Считается сильно скрытым
- Броски атаки с преимуществом
- Атаки по персонажу с помехой

## Паралич (Paralyzed)
- Недееспособен и не может двигаться или говорить
- Автоматически проваливает спасброски Силы и Ловкости
- Атаки по персонажу с преимуществом
- Критический удар при попадании в ближнем бою

## Окаменение (Petrified)
- Превращен в камень вместе с экипировкой
- Сопротивление всем видам урона
- Иммунитет к яду и болезням

## Отравление (Poisoned)
- Помеха на броски атаки и проверки характеристик

## Лежачее положение (Prone)
- Может только ползать или встать (тратя половину скорости)
- Помеха на броски атаки
- Атаки в ближнем бою с преимуществом, дальнем бою с помехой

## Оглушение (Stunned)
- Недееспособен, не может двигаться, говорит с трудом
- Автоматически проваливает спасброски Силы и Ловкости
- Атаки по персонажу с преимуществом

## Бессознательное состояние (Unconscious)
- Недееспособен, не может двигаться или говорить, не осознает окружения
- Роняет удерживаемые предметы и падает ничком
- Автоматически проваливает спасброски Силы и Ловкости
- Атаки по персонажу с преимуществом
- Критический удар при попадании в ближнем бою
    `
  }
];

const RulesList: React.FC<RulesListProps> = ({ searchQuery, setSelectedRule }) => {
  const { theme, themeStyles } = useTheme();
  const themeKey = (theme || 'default') as keyof typeof themes;
  const currentTheme = themeStyles || themes[themeKey] || themes.default;

  // Фильтрация правил по поиску
  const filteredRules = rulesData.filter(rule =>
    rule.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
    rule.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
    rule.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
    rule.content.toLowerCase().includes(searchQuery.toLowerCase())
  );

  if (filteredRules.length === 0) {
    return (
      <div 
        className="text-center py-8"
        style={{ color: currentTheme.textColor }}
      >
        Правила не найдены. Попробуйте изменить запрос поиска.
      </div>
    );
  }

  return (
    <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {filteredRules.map((rule) => (
        <Card 
          key={rule.id} 
          className="p-6 transition-all duration-300 hover:shadow-lg cursor-pointer"
          style={{ 
            backgroundColor: `${currentTheme.cardBackground}dd`,
            borderColor: currentTheme.borderColor,
            color: currentTheme.textColor 
          }}
        >
          <div className="flex flex-col h-full">
            <div className="mb-3">
              <div 
                className="text-xs font-medium uppercase tracking-wide mb-2"
                style={{ color: currentTheme.accent }}
              >
                {rule.category}
              </div>
              <h3 
                className="text-xl font-bold mb-2"
                style={{ color: currentTheme.accent }}
              >
                {rule.title}
              </h3>
              <p 
                className="text-sm opacity-80 line-clamp-3"
                style={{ color: currentTheme.textColor }}
              >
                {rule.description}
              </p>
            </div>
            
            <div className="mt-auto">
              <Button
                onClick={() => setSelectedRule(rule)}
                className="w-full"
                style={{
                  backgroundColor: currentTheme.accent,
                  color: currentTheme.buttonText,
                  border: `1px solid ${currentTheme.accent}`
                }}
              >
                ПОДРОБНЕЕ
              </Button>
            </div>
          </div>
        </Card>
      ))}
    </div>
  );
};

export default RulesList;